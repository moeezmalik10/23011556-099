using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace Program3
{
    public partial class Form2 : Form
    {
        public Form2()
        {
            InitializeComponent();
            // wire up button clicks
            button1.Click += Button1_Click; // Add Book
            button2.Click += Button2_Click; // Borrow Book
            button3.Click += Button3_Click; // View Borrowed Books
        }

        private void Form2_Load(object sender, EventArgs e)
        {

        }

        private void Button1_Click(object? sender, EventArgs e)
        {
            // simple prompts to add a book
            var title = Microsoft.VisualBasic.Interaction.InputBox("Enter book title:", "Add Book");
            if (string.IsNullOrWhiteSpace(title)) return;
            var author = Microsoft.VisualBasic.Interaction.InputBox("Enter author:", "Add Book");
            if (string.IsNullOrWhiteSpace(author)) return;
            DataStore.AddBook(new Book { Title = title, Author = author });
            MessageBox.Show("Book added.");
        }

        private void Button2_Click(object? sender, EventArgs e)
        {
            // show a selection dialog of available books
            var available = DataStore.Books.Where(b => b.IsAvailable).ToList();
            if (!available.Any())
            {
                MessageBox.Show("No available books to borrow.");
                return;
            }

            using var dlg = new SelectBookForm(available);
            if (dlg.ShowDialog() == DialogResult.OK)
            {
                var id = dlg.SelectedBookId;
                if (DataStore.BorrowBook(id))
                {
                    MessageBox.Show("Book borrowed.");
                }
                else
                {
                    MessageBox.Show("Failed to borrow book.");
                }
            }
        }

        private void Button3_Click(object? sender, EventArgs e)
        {
            var view = new Form3();
            view.Show();
        }
    }
}
